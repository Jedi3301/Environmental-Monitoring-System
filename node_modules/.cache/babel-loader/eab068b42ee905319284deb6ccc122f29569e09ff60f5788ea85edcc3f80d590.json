{"ast":null,"code":"import React,{useEffect,useState}from'react';import{supabase}from'./supabaseClient';import EditableTable from'./EditableTable';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function AdminDashboard(){const[roles,setRoles]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();useEffect(()=>{const fetchRoles=async()=>{setLoading(true);setError(null);const{data:{user}}=await supabase.auth.getUser();if(!user){setError('Not logged in.');setLoading(false);return;}const{data,error}=await supabase.from('admin_roles').select('role, section').eq('user_id',user.id);if(error){setError('Failed to fetch roles.');setLoading(false);return;}setRoles(data||[]);setLoading(false);};fetchRoles();},[]);const canEdit=tableName=>{if(roles.some(r=>r.role==='master_admin'))return true;return roles.some(r=>r.role==='admin'&&r.section===tableName);};const handleLogout=async()=>{await supabase.auth.signOut();navigate('/admin');};if(loading){return/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center'},children:\"Loading...\"});}if(error){return/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center',color:'red'},children:error});}if(!roles.length){return/*#__PURE__*/_jsx(\"div\",{style:{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center',color:'#888'},children:\"You do not have admin access.\"});}return/*#__PURE__*/_jsxs(\"div\",{style:{minHeight:'100vh',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',background:'linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%)',position:'relative'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,style:{position:'absolute',top:24,right:32,background:'#1976d2',color:'#fff',border:'none',borderRadius:6,padding:'8px 18px',fontWeight:600,cursor:'pointer',boxShadow:'0 2px 8px rgba(25, 118, 210, 0.08)'},children:\"Logout\"}),/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:'2.5rem',fontWeight:800,color:'#1a237e',marginBottom:24,textShadow:'0 2px 8px rgba(0,0,0,0.08)'},children:\"Admin Dashboard\"}),/*#__PURE__*/_jsxs(\"div\",{style:{background:'rgba(255,255,255,0.85)',borderRadius:20,boxShadow:'0 8px 32px 0 rgba(99,102,241,0.13)',padding:32,minWidth:320,textAlign:'center'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#1976d2',fontWeight:700,marginBottom:16},children:\"Edit Environmental Data\"}),canEdit('air_quality')&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:32},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Air Quality Data\"}),/*#__PURE__*/_jsx(EditableTable,{tableName:\"air_quality\",columns:[\"id\",\"pm2_5\",\"pm10\",\"co2\",\"aqi\",\"recorded_at\"],canEdit:canEdit('air_quality')})]}),canEdit('water_quality')&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:32},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Water Quality Data\"}),/*#__PURE__*/_jsx(EditableTable,{tableName:\"water_quality\",columns:[\"id\",\"ph\",\"turbidity\",\"dissolved_oxy\",\"recorded_at\"],canEdit:canEdit('water_quality')})]}),canEdit('weather_forecast')&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:32},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Weather Forecast Data\"}),/*#__PURE__*/_jsx(EditableTable,{tableName:\"weather_forecast\",columns:[\"id\",\"temperature\",\"humidity\",\"wind_speed\",\"forecast_time\"],canEdit:canEdit('weather_forecast')})]}),!canEdit('air_quality')&&!canEdit('water_quality')&&!canEdit('weather_forecast')&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#888'},children:\"You do not have permission to edit any data.\"})]})]});}export default AdminDashboard;","map":{"version":3,"names":["React","useEffect","useState","supabase","EditableTable","useNavigate","jsx","_jsx","jsxs","_jsxs","AdminDashboard","roles","setRoles","loading","setLoading","error","setError","navigate","fetchRoles","data","user","auth","getUser","from","select","eq","id","canEdit","tableName","some","r","role","section","handleLogout","signOut","style","minHeight","display","alignItems","justifyContent","children","color","length","flexDirection","background","position","onClick","top","right","border","borderRadius","padding","fontWeight","cursor","boxShadow","fontSize","marginBottom","textShadow","minWidth","textAlign","columns"],"sources":["C:/Users/Jedi/Desktop/Final Year Project/weather-monitoring-frontend/src/AdminDashboard.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { supabase } from './supabaseClient';\nimport EditableTable from './EditableTable';\nimport { useNavigate } from 'react-router-dom';\n\nfunction AdminDashboard() {\n  const [roles, setRoles] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const fetchRoles = async () => {\n      setLoading(true);\n      setError(null);\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        setError('Not logged in.');\n        setLoading(false);\n        return;\n      }\n      const { data, error } = await supabase\n        .from('admin_roles')\n        .select('role, section')\n        .eq('user_id', user.id);\n      if (error) {\n        setError('Failed to fetch roles.');\n        setLoading(false);\n        return;\n      }\n      setRoles(data || []);\n      setLoading(false);\n    };\n    fetchRoles();\n  }, []);\n\n  const canEdit = tableName => {\n    if (roles.some(r => r.role === 'master_admin')) return true;\n    return roles.some(r => r.role === 'admin' && r.section === tableName);\n  };\n\n  const handleLogout = async () => {\n    await supabase.auth.signOut();\n    navigate('/admin');\n  };\n\n  if (loading) {\n    return <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>Loading...</div>;\n  }\n  if (error) {\n    return <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'red' }}>{error}</div>;\n  }\n  if (!roles.length) {\n    return <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#888' }}>You do not have admin access.</div>;\n  }\n\n  return (\n    <div style={{ minHeight: '100vh', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', background: 'linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%)', position: 'relative' }}>\n      <button onClick={handleLogout} style={{ position: 'absolute', top: 24, right: 32, background: '#1976d2', color: '#fff', border: 'none', borderRadius: 6, padding: '8px 18px', fontWeight: 600, cursor: 'pointer', boxShadow: '0 2px 8px rgba(25, 118, 210, 0.08)' }}>\n        Logout\n      </button>\n      <h1 style={{ fontSize: '2.5rem', fontWeight: 800, color: '#1a237e', marginBottom: 24, textShadow: '0 2px 8px rgba(0,0,0,0.08)' }}>\n        Admin Dashboard\n      </h1>\n      <div style={{ background: 'rgba(255,255,255,0.85)', borderRadius: 20, boxShadow: '0 8px 32px 0 rgba(99,102,241,0.13)', padding: 32, minWidth: 320, textAlign: 'center' }}>\n        <h2 style={{ color: '#1976d2', fontWeight: 700, marginBottom: 16 }}>Edit Environmental Data</h2>\n        {canEdit('air_quality') && (\n          <div style={{ marginBottom: 32 }}>\n            <h3>Air Quality Data</h3>\n            <EditableTable\n              tableName=\"air_quality\"\n              columns={[\"id\", \"pm2_5\", \"pm10\", \"co2\", \"aqi\", \"recorded_at\"]}\n              canEdit={canEdit('air_quality')}\n            />\n          </div>\n        )}\n        {canEdit('water_quality') && (\n          <div style={{ marginBottom: 32 }}>\n            <h3>Water Quality Data</h3>\n            <EditableTable\n              tableName=\"water_quality\"\n              columns={[\"id\", \"ph\", \"turbidity\", \"dissolved_oxy\", \"recorded_at\"]}\n              canEdit={canEdit('water_quality')}\n            />\n          </div>\n        )}\n        {canEdit('weather_forecast') && (\n          <div style={{ marginBottom: 32 }}>\n            <h3>Weather Forecast Data</h3>\n            <EditableTable\n              tableName=\"weather_forecast\"\n              columns={[\"id\", \"temperature\", \"humidity\", \"wind_speed\", \"forecast_time\"]}\n              canEdit={canEdit('weather_forecast')}\n            />\n          </div>\n        )}\n        {!canEdit('air_quality') && !canEdit('water_quality') && !canEdit('weather_forecast') && (\n          <div style={{ color: '#888' }}>You do not have permission to edit any data.</div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default AdminDashboard; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}